(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{656:function(t,e,r){"use strict";r(16);var n={data:function(){return{isTimerEnabled:!0,timerId:null,timerInterval:6e4}},watch:{isTimerEnabled:function(){this.resetTimer()},timerInterval:function(){this.resetTimer()}},mounted:function(){this.resetTimer()},beforeDestroy:function(){this.clearTimer()},methods:{clearTimer:function(){this.timerId&&clearTimeout(this.timerId),this.timerId=null},resetTimer:function(){var t=this;this.clearTimer(),this.isTimerEnabled&&(this.timerId=setTimeout(function(){Promise.resolve().then(t.timerCallback).finally(t.resetTimer)},this.timerInterval))},timerCallback:function(){}}};e.a=n},786:function(t,e,r){"use strict";r.r(e);r(30),r(29),r(16),r(58);var n=r(23),o=(r(18),r(720)),l=r.n(o),c={props:{id:{default:0,type:Number},options:{default:function(){return{chart:{height:500,zoomType:"x"},title:{text:"Time Series Chart"},xAxis:{crosshair:!0,title:{text:"Time"},type:"datetime"},yAxis:[{title:{text:"(unit)"}}]}},type:Object},seriesOptions:{default:function(){return[]},type:Array},fetchSpec:{default:function(){return{queries:[]}},type:Object},worker:{default:null,type:Worker}},watch:{options:function(t){this.chart.update(t)}},created:function(){this.worker.addEventListener("message",this.workerMessageHandler)},mounted:function(){this.chart=l.a.chart(this.$refs.chart,this.options),this.worker.postMessage({id:this.id,fetchSpec:this.fetchSpec})},beforeDestroy:function(){this.chart.destroy(),this.chart=null,this.worker.removeEventListener("message",this.workerMessageHandler)},methods:{removeAllSeries:function(){var t=this.chart;if(t)for(;t.series.length>0;)t.series[0].remove()},workerMessageHandler:function(t){var data=t.data;if(data.id===this.id){if(data.series){var e=data.series,r=data.total,n=Object.assign({step:!0,zIndex:e.index},this.seriesOptions[e.index],{data:e.data});return this.chart.addSeries(n),void this.chart.showLoading("Loaded ".concat(r," points..."))}if(data.isFetching)return this.removeAllSeries(),void this.chart.showLoading();data.isDone&&this.chart.hideLoading()}}}},d=r(56),m=Object(d.a)(c,function(){var t=this.$createElement;return(this._self._c||t)("div",{ref:"chart"})},[],!1,null,null,null).exports,v=r(0),h=r.n(v),f=r(656),_=r(664),y=r.n(_),x=r(721),k=r.n(x),D=r(48),w={$_veeValidate:{validator:"new"},components:{HcTimeSeries:m},middleware:["check-org","dt-unit-vocabulary","system-time-utc"],mixins:[f.a],data:function(){return{charts:[],chartTitle:"My Awesome Data",datastreamsHeaders:[{align:"center",sortable:!1,text:"Select",value:"_id"},{align:"left",sortable:!1,text:"Name",value:"name",width:"40%"},{align:"left",sortable:!1,text:"Description",value:"description"}],datastreamsPagination:{descending:!1,page:1,rowsPerPage:10,sortBy:null,totalItems:null},datastreamsSearch:null,datastreamsSearchDebounce:null,tabIndex:0,dateDialog:!1,fromDate:h()().startOf("d").subtract(14,"d").format("YYYY-MM-DD"),toDate:h()().endOf("d").format("YYYY-MM-DD"),queryDatastreamIds:[],selectedDatastreamsHeaders:[{align:"center",sortable:!1,text:"Y-Axis",value:"_id"},{align:"left",sortable:!1,text:"Name",value:"name",width:"40%"},{align:"left",sortable:!1,text:"Description",value:"description"},{align:"center",sortable:!1,value:"_id"}],selectedStationIds:null,selectedTermLabels:{},timerInterval:6e4}},computed:Object(n.a)({},Object(D.c)(["getUnitAbbr","org"]),Object(D.c)({cartCount:"cart/count",cartIds:"cart/ids"}),Object(D.c)({getDatastream:"datastreams/get"}),Object(D.e)(["auth"]),Object(D.e)("cart",["quantitiesById"]),{datastreamsFetchQuery:function(){var t=this.datastreamsPagination,e=this.datastreamsSearch,r=this.selectedStationIds,n=this.selectedTermLabels,o=t.page,l=t.rowsPerPage,c={is_hidden:!1,organization_id:this.org._id,$limit:l,$skip:(o-1)*l,$select:["_id","is_hidden","name","description","organization_id","station_id"],$sort:{name:1}};e&&e.length&&(c.$text={$search:"".concat(this.datastreamsSearch)}),r&&r.length&&(c.station_id={$in:r});var d=[];return Object.keys(n).forEach(function(t){var e=n[t].map(function(e){return"ds_".concat(t,"_").concat(e)});e.length&&d.push({"terms_info.class_tags":{$in:e}})}),d.length&&(c.$and=d),c},datastreamsPaginationBrowser:function(){return this.$store.state.datastreams.pagination.browser},datastreamsQuery:function(){return{_id:{$in:this.queryDatastreamIds},$sort:{name:1}}},selectedDatastreamsQuery:function(){return{_id:{$in:this.cartIds},$sort:{name:1}}}}),watch:{datastreamsPaginationBrowser:function(t){this.queryDatastreamIds=t&&t.ids},datastreamsSearchDebounce:function(t){this.debouncedDatastreamsSearch(t)},selectedStationIds:function(){this.datastreamsPagination.page=1},selectedTermLabels:{handler:function(){this.datastreamsPagination.page=1},deep:!0}},created:function(){var t=this,e=this.$route.query;e&&e.stationId&&(this.selectedStationIds=[e.stationId]),this.debouncedDatastreamsSearch=y()(function(e){t.datastreamsSearch=e},400),this.seriesFetchWorker=this.$workers.createSeriesFetchWorker(),this.seriesFetchWorker.postMessage({accessToken:this.auth.accessToken}),this.uniqueCounter=2147483648*Math.random()|0,this.resetCart()},beforeDestroy:function(){this.debouncedDatastreamsSearch.cancel(),this.debouncedDatastreamsSearch=null,this.seriesFetchWorker.terminate(),this.seriesFetchWorker=null},methods:Object(n.a)({},Object(D.b)(["getSystemTimeUTC"]),Object(D.d)({incrementQuantity:"cart/incrementQuantity",resetCart:"cart/reset",setQuantity:"cart/setQuantity"}),{addChart:function(){var t=this,e={chart:{height:500,zoomType:"x"},title:{text:this.chartTitle},xAxis:{crosshair:!0,title:{text:"Time"},type:"datetime"},yAxis:[{title:{text:null}},{opposite:!0,title:{text:null}}]},r=[],n={queries:[],startTime:h.a.utc(this.fromDate).toISOString(),untilTime:h.a.utc(this.toDate).startOf("d").add(1,"d").toISOString()};k()(this.quantitiesById,function(e,o){var l=t.getDatastream(o);r.push({name:l.name,yAxis:e-1}),n.queries.push({datastream_id:o})}),this.charts.unshift({id:this.uniqueCounter++,options:e,seriesOptions:r,fetchSpec:n}),this.resetCart()},print:function(t){this.$logger.log(t)},goToChart:function(){var t=this;this.$vuetify.goTo(0,{duration:0}).then(function(){t.tabIndex=1})},timerCallback:function(){return this.getSystemTimeUTC()}})},T=r(165),S=r.n(T),C=r(657),I=r(160),$=r(794),O=r(626),V=r(677),j=r(637),M=r(151),Q=r(785),F=r(782),P=r(780),L=r(199),A=r(156),z=r(162),Y=r(157),E=r(632),H=r(781),B=r(793),N=r(787),W=r(676),U=Object(d.a)(w,function(){var t=this,e=t.$createElement,r=t._self._c||e;return t.org?r("v-layout",{attrs:{column:""}},[r("v-flex",[r("v-container",{attrs:{"grid-list-xl":""}},[r("v-layout",{attrs:{column:""}},[r("v-flex",[r("v-tabs",{staticClass:"elevation-2",attrs:{"fixed-tabs":""},model:{value:t.tabIndex,callback:function(e){t.tabIndex=e},expression:"tabIndex"}},[r("v-tab",[t._v("\n              Search\n            ")]),t._v(" "),r("v-tab",[t._v("\n              Chart\n            ")]),t._v(" "),r("v-tab",{attrs:{disabled:""}},[t._v("\n              Download\n            ")]),t._v(" "),r("v-tab-item",[r("v-card",{attrs:{flat:""}},[r("v-card-title",{staticClass:"headline",attrs:{"primary-title":""}},[t._v("\n                  Datastreams\n                ")]),t._v(" "),r("v-container",{attrs:{fluid:""}},[r("feathers-vuex-find",{attrs:{query:{is_hidden:!1,organization_id:t.org._id,station_type:"weather",$sort:{name:1}},service:"stations"},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.isFindPending,o=e.items;return r("v-layout",{attrs:{row:"",wrap:""}},[r("v-flex",{attrs:{xs12:""}},[r("v-autocomplete",{attrs:{items:o,label:n?"Loading...":"Station",loading:n,box:"",chips:"",clearable:"","deletable-chips":"",flat:"","hide-details":"","hide-no-data":"","item-text":"name","item-value":"_id",multiple:""},model:{value:t.selectedStationIds,callback:function(e){t.selectedStationIds=e},expression:"selectedStationIds"}})],1)],1)}}],null,!1,2173491680)}),t._v(" "),r("feathers-vuex-find",{attrs:{query:{is_hidden:!1,scheme_id:"ds",vocabulary_type:"class",$sort:{name:1}},service:"vocabularies"},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.items;return r("v-layout",{attrs:{row:"",wrap:""}},t._l(n,function(e){return r("v-flex",{key:e._id,attrs:{xs12:"",md6:""}},[r("v-autocomplete",{attrs:{items:e.terms,label:e.label,"item-text":function(t){return t.name||t.label},box:"",chips:"",clearable:"","deletable-chips":"",flat:"","hide-details":"","hide-no-data":"","item-value":"label",multiple:""},model:{value:t.selectedTermLabels[e.label],callback:function(r){t.$set(t.selectedTermLabels,e.label,r)},expression:"selectedTermLabels[vocabulary.label]"}})],1)}),1)}}],null,!1,2379951734)}),t._v(" "),r("feathers-vuex-find",{attrs:{"fetch-query":t.datastreamsFetchQuery,query:t.datastreamsQuery,watch:["fetchQuery.$and","fetchQuery.$limit","fetchQuery.$skip","fetchQuery.$text","fetchQuery.station_id"],qid:"browser",service:"datastreams"},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.isFindPending,o=e.items,l=e.pagination;return r("v-layout",{attrs:{row:"",wrap:""}},[r("v-flex",{attrs:{xs12:""}},[r("v-text-field",{attrs:{"append-icon":"search",clearable:"",label:"Filter datastreams"},model:{value:t.datastreamsSearchDebounce,callback:function(e){t.datastreamsSearchDebounce="string"==typeof e?e.trim():e},expression:"datastreamsSearchDebounce"}})],1),t._v(" "),r("v-flex",{attrs:{xs12:""}},[r("v-data-table",{attrs:{headers:t.datastreamsHeaders,items:o,loading:n,pagination:t.datastreamsPagination,"rows-per-page-items":[5,10,25,50],"total-items":l?l.total:0,"disable-initial-sort":"","item-key":"_id"},on:{"update:pagination":function(e){t.datastreamsPagination=e}},scopedSlots:t._u([{key:"items",fn:function(e){return[r("td",{staticClass:"text-xs-center"},[r("v-btn",{attrs:{color:"primary",flat:"",icon:"",small:""},on:{click:function(r){return t.incrementQuantity({id:e.item._id,max:1})}}},[e.item.quantitySelected?r("v-icon",[t._v("check_box")]):r("v-icon",[t._v("check_box_outline_blank")])],1)],1),t._v(" "),r("td",[t._v(t._s(e.item.name))]),t._v(" "),r("td",[t._v(t._s(e.item.description))])]}}],null,!0)})],1)],1)}}],null,!1,3468364293)})],1),t._v(" "),r("v-card-actions",[r("v-btn",{attrs:{disabled:!t.cartCount},on:{click:t.resetCart}},[t._v("Reset")]),t._v(" "),r("v-btn",{attrs:{disabled:!t.cartCount},on:{click:t.goToChart}},[t._v("Chart")]),t._v(" "),r("v-btn",{attrs:{disabled:""}},[t._v("Download")])],1)],1)],1),t._v(" "),r("v-tab-item",[t.cartCount||!t.charts.length?r("v-card",{attrs:{flat:""}},[r("v-card-title",{staticClass:"headline",attrs:{"primary-title":""}},[t._v("\n                  Selected datastreams\n                ")]),t._v(" "),r("v-container",{attrs:{fluid:""}},[r("feathers-vuex-find",{attrs:{query:t.selectedDatastreamsQuery,watch:"query",local:"",service:"datastreams"},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.items;return r("v-layout",{attrs:{row:"",wrap:""}},[r("v-flex",{attrs:{xs12:""}},[r("v-data-table",{attrs:{headers:t.selectedDatastreamsHeaders,items:n,"disable-initial-sort":"","item-key":"_id"},scopedSlots:t._u([{key:"items",fn:function(e){return[r("td",{staticClass:"text-xs-center"},[r("v-btn-toggle",{staticClass:"elevation-0",attrs:{value:e.item.quantitySelected,mandatory:""},on:{change:function(r){return t.setQuantity({id:e.item._id,value:r})}}},[r("v-btn",{attrs:{value:1,flat:"",small:""}},[t._v("Y1")]),t._v(" "),r("v-btn",{attrs:{value:2,flat:"",small:""}},[t._v("Y2")])],1)],1),t._v(" "),r("td",[t._v(t._s(e.item.name))]),t._v(" "),r("td",[t._v(t._s(e.item.description))]),t._v(" "),r("td",{staticClass:"text-xs-center"},[r("v-btn",{attrs:{icon:"",small:""},on:{click:function(r){return t.setQuantity({id:e.item._id,value:0})}}},[r("v-icon",{attrs:{color:"grey lighten1"}},[t._v("remove_circle")])],1)],1)]}}],null,!0)})],1)],1)}}],null,!1,1278297463)})],1)],1):t._e(),t._v(" "),r("v-card",{attrs:{flat:""}},[r("v-dialog",{ref:"dateDialog",attrs:{lazy:"","max-width":"680"},model:{value:t.dateDialog,callback:function(e){t.dateDialog=e},expression:"dateDialog"}},[r("v-card",[r("v-card-title",{staticClass:"headline"},[t._v("Date range")]),t._v(" "),r("v-container",{attrs:{"grid-list-lg":""}},[r("v-layout",{attrs:{"align-center":"","justify-center":"",row:"",wrap:""}},[r("v-flex",{attrs:{shrink:""}},[r("v-date-picker",{attrs:{"no-title":""},model:{value:t.fromDate,callback:function(e){t.fromDate=e},expression:"fromDate"}})],1),t._v(" "),r("v-flex",{attrs:{shrink:""}},[r("v-date-picker",{attrs:{"no-title":""},model:{value:t.toDate,callback:function(e){t.toDate=e},expression:"toDate"}})],1)],1)],1),t._v(" "),r("v-card-actions",[r("v-spacer"),t._v(" "),r("v-btn",{attrs:{flat:"",color:"primary"},on:{click:function(e){t.dateDialog=!1}}},[t._v("Close")])],1)],1)],1),t._v(" "),r("v-container",{attrs:{fluid:""}},[r("v-layout",{attrs:{row:"",wrap:""}},[r("v-flex",{attrs:{xs12:"",sm6:""}},[r("v-text-field",{directives:[{name:"validate",rawName:"v-validate",value:"required|date_format:yyyy-MM-dd",expression:"'required|date_format:yyyy-MM-dd'"}],attrs:{"error-messages":t.errors.collect("fromDate"),"append-icon":"event",box:"","data-vv-name":"fromDate",label:"From date",required:""},on:{"click:append":function(e){t.dateDialog=!0}},model:{value:t.fromDate,callback:function(e){t.fromDate=e},expression:"fromDate"}})],1),t._v(" "),r("v-flex",{attrs:{xs12:"",sm6:""}},[r("v-text-field",{directives:[{name:"validate",rawName:"v-validate",value:"required|date_format:yyyy-MM-dd",expression:"'required|date_format:yyyy-MM-dd'"}],attrs:{"error-messages":t.errors.collect("toDate"),"append-icon":"event",box:"","data-vv-name":"toDate",label:"To date",required:""},on:{"click:append":function(e){t.dateDialog=!0}},model:{value:t.toDate,callback:function(e){t.toDate=e},expression:"toDate"}})],1),t._v(" "),t.cartCount||!t.charts.length?r("v-flex",{attrs:{xs12:""}},[r("v-text-field",{directives:[{name:"validate",rawName:"v-validate",value:"max:100",expression:"'max:100'"}],attrs:{"error-messages":t.errors.collect("chartTitle"),box:"",clearable:"","data-vv-name":"chartTitle",label:"Chart title",required:""},model:{value:t.chartTitle,callback:function(e){t.chartTitle=e},expression:"chartTitle"}})],1):t._e()],1)],1),t._v(" "),r("v-card-actions",[r("v-btn",{attrs:{disabled:!t.cartCount,block:"",color:"primary",large:""},on:{click:t.addChart}},[t._v("Chart\n                    "+t._s(t.cartCount)+"\n                    "+t._s(t._f("pluralize")(t.cartCount,"Datastream"))+"\n                  ")])],1)],1)],1),t._v(" "),r("v-tab-item",[r("v-card",{attrs:{flat:""}},[r("v-card-text",[t._v("\n                  Coming soon!\n                ")])],1)],1)],1)],1)],1)],1)],1),t._v(" "),t.charts.length?r("v-flex",{directives:[{name:"show",rawName:"v-show",value:1===t.tabIndex,expression:"tabIndex === 1"}]},[r("v-container",{attrs:{fluid:"","grid-list-xl":""}},[r("v-layout",{attrs:{column:""}},t._l(t.charts,function(e,i){return r("v-flex",{key:e.id},[r("v-card",[r("hc-time-series",{attrs:{id:e.id,options:Object.freeze(e.options),"series-options":Object.freeze(e.seriesOptions),"fetch-spec":Object.freeze(e.fetchSpec),worker:Object.freeze(t.seriesFetchWorker)}}),t._v(" "),r("v-fab-transition",[r("v-btn",{attrs:{absolute:"",color:"grey lighten1",dark:"",fab:"",right:"",small:"",top:""},on:{click:function(e){return t.charts.splice(i,1)}}},[r("v-icon",[t._v("remove")])],1)],1)],1)],1)}),1)],1)],1):t._e()],1):t._e()},[],!1,null,null,null);e.default=U.exports;S()(U,{VAutocomplete:C.a,VBtn:I.a,VBtnToggle:$.a,VCard:O.a,VCardActions:V.a,VCardText:V.b,VCardTitle:j.a,VContainer:M.a,VDataTable:Q.a,VDatePicker:F.a,VDialog:P.a,VFabTransition:L.b,VFlex:A.a,VIcon:z.a,VLayout:Y.a,VSpacer:E.a,VTab:H.a,VTabItem:B.a,VTabs:N.a,VTextField:W.a})}}]);